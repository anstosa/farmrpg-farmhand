// ==UserScript==
// @name Farm RPG Farmhand
// @description Your helper around the RPG Farm
// @version 1.0.0
// @author Ansel Santosa <568242+anstosa@users.noreply.github.com>
// @match https://farmrpg.com/*
// @grant GM.getValue
// @grant GM.setValue
// @icon https://www.google.com/s2/favicons?sz=64&domain=farmrpg.com
// ==/UserScript==

(()=>{"use strict";var e={92:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.banker=t.SETTING_BANKER=void 0;const i=n(903),r=n(952),a=n(178),l=n(906),s=n(469);t.SETTING_BANKER={id:"banker",title:"Banker",description:"\n    * Automatically calculates your target balance (minimum balance required to maximize your daily interest)\n    * Adds an option *Deposit Target Balance* which deposits up to your target balance\n    * Adds an option to *Withdraw Interest* which withdraws any earnings on top of your target balance\n  ",type:"boolean",defaultValue:!0},t.banker={settings:[t.SETTING_BANKER],onPageChange:(e,n)=>{var d,c,u,v;if(!e[t.SETTING_BANKER.id].value)return;if(n!==r.Page.BANK)return;if(!(0,r.getCurrentPage)())return;const m=(0,r.getCardByTitle)("About the bank");if(!m)return void console.error("About card not found");const f=m.querySelectorAll("strong"),p=Number(null===(d=f[0].textContent)||void 0===d?void 0:d.replaceAll("%",""))/100,g=Number(null===(c=f[1].textContent)||void 0===c?void 0:c.replaceAll(",","")),b=m.nextElementSibling;if(!b)return void console.error("balance card not found");const E=b.querySelectorAll("strong"),y=Number(null===(u=E[0].textContent)||void 0===u?void 0:u.replaceAll(",","").replaceAll(" Silver","")),h=new Intl.NumberFormat,S=Math.ceil(g/p),T=document.createElement("div");T.classList.add("card-content-inner"),T.innerHTML=`\n      Target Balance: <strong style="color: ${S===y?a.GREEN_SUCCESS:a.YELLOW_WARNING}">${h.format(S)} Silver</strong>\n    `,null===(v=b.firstElementChild)||void 0===v||v.append(T);const _=Math.max(0,y-S);console.debug(p,g,y);const w=(0,r.getListByTitle)("Bulk Options");if(!w)return void console.error("Bulk Options list not found");const N=Math.max(0,S-y),R=document.createElement("li");R.innerHTML=`\n      <a\n        href="#"\n        data-view=".view-main"\n        class="item-link close-panel"\n      >\n        <div class="item-content">\n          <div class="item-inner">\n            <div class="item-title">\n              <i class="fa fa-fw fa-arrow-right"></i>\n              Deposit Target Balance\n            </div>\n            <div class="item-after">${h.format(N)} Silver</div>\n          </div>\n        </div>\n      </a>\n    `,R.addEventListener("click",(e=>{e.preventDefault(),0!==N&&(0,l.showConfirmation)(`Deposit ${h.format(N)} Silver?`,(()=>o(void 0,void 0,void 0,(function*(){yield(0,i.depositSilver)(N),yield(0,s.showPopup)("Success!","You deposited Silver!"),window.location.reload()}))))})),w.insertBefore(R,w.children[w.children.length-1]);const O=document.createElement("li");O.innerHTML=`\n      <a\n        href="#"\n        data-view=".view-main"\n        class="item-link close-panel"\n      >\n        <div class="item-content">\n          <div class="item-inner">\n            <div class="item-title">\n              <i class="fa fa-fw fa-arrow-left"></i>\n              Withdraw Interest\n            </div>\n            <div class="item-after">${h.format(_)} Silver</div>\n          </div>\n        </div>\n      </a>\n    `,O.addEventListener("click",(e=>{e.preventDefault(),0!==_&&(0,l.showConfirmation)(`Withdraw ${h.format(_)} Silver?`,(()=>o(void 0,void 0,void 0,(function*(){yield(0,i.withdrawSilver)(_),yield(0,s.showPopup)("Success!","You withdrew Silver!"),window.location.reload()}))))})),w.insertBefore(O,w.children[w.children.length-1])}}},273:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buddyFarm=t.SETTING_BUDDY_FARM=void 0;const o=n(952);t.SETTING_BUDDY_FARM={id:"buddyFarm",title:"Buddy's Almanac",description:"Add shortcut to look up items on buddy.farm",type:"boolean",defaultValue:!0},t.buddyFarm={settings:[t.SETTING_BUDDY_FARM],onPageChange:(e,n)=>{var i;if(!e[t.SETTING_BUDDY_FARM.id].value)return;const r=(0,o.getCurrentPage)();if(!r)return;if(n!==o.Page.ITEM)return;const a=document.querySelector(".sharelink");if(!a)return void console.error("Item header not found");const l=`https://buddy.farm/i/${(null!==(i=a.textContent)&&void 0!==i?i:"").toLowerCase().replaceAll(/[\s']/g,"-")}`,s=[...r.querySelectorAll(".content-block-title")].find((e=>"Item Details"===e.textContent)),d=null==s?void 0:s.nextElementSibling,c=null==d?void 0:d.querySelector("ul");if(!c)return void console.error("Item Details list not found");const u=document.createElement("li");u.classList.add("close-panel"),u.innerHTML=`\n      <div class="item-content">\n        <div class="item-media">\n          <a\n            href="https://buddy.farm"\n            onclick="window.open('https://buddy.farm', '_blank');return false;"\n          >\n            <img src="https://buddy.farm/icons/icon-256x256.png" class="itemimg">\n          </a>\n        </div>\n        <div class="item-inner">\n          <div class="item-title">\n            Buddy's Almanac\n            <br><span style="font-size: 11px">Lookup item on buddy.farm</span>\n          </div>\n          <div class="item-after">\n            <a\n              href="${l}"\n              onclick="window.open('${l}', '_blank');return false;"\n              class="button btngreen"\n              style="height:28px"\n            >OPEN</a>\n          </div>\n        </div>\n      </div>\n    `,c.insertBefore(u,c.firstChild)}}},973:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.farmhandSettings=t.setSetting=t.getSetting=t.getSettings=void 0;const i=n(952);t.getSettings=e=>o(void 0,void 0,void 0,(function*(){var t;const n={};for(const o of e)for(const e of null!==(t=o.settings)&&void 0!==t?t:[])n[e.id]=Object.assign(Object.assign({},e),{value:yield GM.getValue(e.id,e.defaultValue)});return n})),t.getSetting=e=>o(void 0,void 0,void 0,(function*(){return Object.assign(Object.assign({},e),{value:yield GM.getValue(e.id,e.defaultValue)})})),t.setSetting=e=>{var t;return GM.setValue(e.id,null!==(t=e.value)&&void 0!==t?t:"")};const r=({id:e,type:t,value:n},o)=>{switch(t){case"boolean":return`\n        <div\n          class="item-inner"\n          role="checkbox"\n          id="${e}-aria"\n          aria-labelledby="${e}"\n          aria-checked="${n?"true":"false"}"\n        >\n          ${o}\n        </div>\n      `;case"number":return`\n        <div\n          class="item-inner"\n          role="spinbutton"\n          id="${e}-aria"\n          aria-labelledby="${e}"\n          aria-valuenow="${n}"\n        >\n          ${o}\n        </div>\n      `;case"string":return`\n        <div\n          class="item-inner"\n          role="textbox"\n          id="${e}-aria"\n          aria-labelledby="${e}"\n        >\n          ${o}\n        </div>\n      `;default:return`\n        <div\n          class="item-inner"\n          id="${e}-aria"\n          aria-labelledby="${e}"\n        >\n          ${o}\n        </div>\n      `}},a=({id:e,type:t,value:n})=>{switch(t){case"boolean":return`\n        <label class="label-switch">\n          <input\n            type="checkbox"\n            class="settings_checkbox"\n            id="${e}"\n            name="${e}"\n            value="${n?1:0}"\n            ${n?'checked=""':""}"\n          />\n          <div class="checkbox"></div>\n        </label>\n      `;case"string":case"number":return`\n        <div class="item-after">\n          <input\n            type="text"\n            name="${e}"\n            value="${n}"\n            class="inlineinputsm"\n            style="width: 60px; font-family: -apple-system, &quot;SF UI Text&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Noto Color Emoji&quot;, EmojiNotoColor, &quot;Noto Emoji&quot;, EmojiNoto, &quot;Segoe UI&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Twitter Color Emoji&quot;, EmojiTwemColor, &quot;Twemoji Mozilla&quot;, EmojiTwem, &quot;EmojiOne Mozilla&quot;, &quot;Android Emoji&quot;, EmojiSymbols, Symbola, EmojiSymb !important;"\n          />\n        </div>\n      `;default:return""}},l=({id:e,type:t},n)=>{const o=n.querySelector(`[name=${e}]`);switch(t){case"boolean":return"true"===n.querySelector(`[id=${e}-aria]`).getAttribute("aria-checked");case"number":return Number(o.value);default:return o.value}};t.farmhandSettings={onPageChange:(e,n)=>{if(n!==i.Page.SETTINGS_OPTIONS)return;const o=(0,i.getCurrentPage)();if(!o)return;const s=o.querySelector("#settingsform_options ul");if(!s)return void console.error("Settings list not found");const d=document.createElement("li");d.classList.add("list-group-title"),d.classList.add("item-divider"),d.textContent="Farmhand Settings",s.append(d);for(const t of Object.values(e)){const e=document.createElement("li");e.innerHTML=`\n        <div class="item-content">\n          ${r(t,`\n            <div class="item-title label" style="width:60%">\n              <label\n                id="${t.id}"\n                for="${t.id}">\n                  ${t.title}\n              </label>\n              <br>\n              <span style="font-size: 11px">${t.description}</span>\n            </div>\n            ${a(t)}\n            `)}\n      </div>\n      `,s.append(e)}const c=o.querySelector("#settings_options");c?c.addEventListener("click",(()=>{for(const n of Object.values(e))n.value=l(n,o),(0,t.setSetting)(n);setTimeout((()=>window.location.reload()),1e3)})):console.error("Save button not found")}}},217:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(92),r=n(273),a=n(973),l=n(952),s=[r.buddyFarm,a.farmhandSettings,i.banker],d=(e,t)=>o(void 0,void 0,void 0,(function*(){const n=yield(0,a.getSettings)(s);for(const{onPageChange:o}of s)o&&o(n,e,t)}));!function(){console.info("STARTING Farmhand by Ansel Santosa");let e=document.location.href;const{body:t}=document;new MutationObserver((()=>{if(e!==document.location.href){e=document.location.href;const[t,n]=(0,l.getPage)();console.debug("Page Change",t,n),d(t,n)}})).observe(t,{childList:!0,subtree:!0}),setTimeout((()=>d(...(0,l.getPage)())))}()},903:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.withdrawSilver=t.depositSilver=t.getStats=t.sendRequest=void 0,t.sendRequest=e=>n(void 0,void 0,void 0,(function*(){const t=yield fetch(`https://farmrpg.com/worker.php?${e.toString()}`,{method:"POST",mode:"cors",credentials:"include"});if(!t.ok)throw new Error(t.statusText);const n=yield t.text();return(new DOMParser).parseFromString(n,"text/html")})),t.getStats=()=>n(void 0,void 0,void 0,(function*(){var e,n,o,i,r,a;const l=(yield(0,t.sendRequest)(new URLSearchParams({go:"getstats"}))).querySelectorAll("span");return{silver:Number(null!==(n=null===(e=l[0].textContent)||void 0===e?void 0:e.trim().replaceAll(",",""))&&void 0!==n?n:"0"),gold:Number(null!==(i=null===(o=l[1].textContent)||void 0===o?void 0:o.trim().replaceAll(",",""))&&void 0!==i?i:"0"),ancientCoins:Number(null!==(a=null===(r=l[2].textContent)||void 0===r?void 0:r.trim().replaceAll(",",""))&&void 0!==a?a:"0")}})),t.depositSilver=e=>n(void 0,void 0,void 0,(function*(){yield(0,t.sendRequest)(new URLSearchParams({go:"depositsilver",amt:e.toString()}))})),t.withdrawSilver=e=>n(void 0,void 0,void 0,(function*(){yield(0,t.sendRequest)(new URLSearchParams({go:"withdrawalsilver",amt:e.toString()}))}))},906:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showConfirmation=void 0,t.showConfirmation=(e,t,n)=>{const o=document.createElement("div");o.classList.add("modal-overlay"),o.classList.add("modal-overlay-visible"),document.body.append(o);const i=document.createElement("div");i.classList.add("actions-modal"),i.classList.add("modal-in"),i.innerHTML=`\n      <div class="actions-modal-group">\n        <div class="actions-modal-label">${e}</div>\n        <div class="actions-modal-button">Yes</div>\n        <div class="actions-modal-button color-red">Cancel</div>\n      </div>\n    `;const r=i.querySelectorAll(".actions-modal-button");r[0].addEventListener("click",(()=>{null==o||o.classList.remove("modal-overlay-visible"),i.remove(),t()})),r[1].addEventListener("click",(()=>{null==o||o.classList.remove("modal-overlay-visible"),i.remove(),null==n||n()})),document.body.append(i)}},952:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getListByTitle=t.getCardByTitle=t.setTitle=t.getCurrentPage=t.getPreviousPage=t.getPage=t.Page=void 0,function(e){e.ITEM="item",e.BANK="bank",e.SETTINGS="settings",e.SETTINGS_OPTIONS="settings_options"}(n||(t.Page=n={})),t.getPage=()=>{const e=window.location.hash.match(/#!\/(\w+).php\?{0,1}(.*)/);return e?[e[1],new URLSearchParams(e[2])]:[void 0,new URLSearchParams]},t.getPreviousPage=()=>document.querySelector(".page-on-left"),t.getCurrentPage=()=>document.querySelector(".page-on-center, .page-from-right-to-center"),t.setTitle=e=>{const t=document.querySelector(".navbar-on-center");if(!t)return void console.error("Navbar not found");const n=null==t?void 0:t.querySelector("center");n?n.textContent=e:console.error("Center text not found")},t.getCardByTitle=e=>{const n=(0,t.getCurrentPage)();if(!n)return console.error("Current page not found"),null;const o=[...n.querySelectorAll(".content-block-title")].find((t=>t.textContent===e));return o?o.nextElementSibling:(console.error(`${e} title not found`),null)},t.getListByTitle=e=>{const n=(0,t.getCardByTitle)(e);return n?n.querySelector("ul"):(console.error(`${e} card not found`),null)}},469:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showPopup=void 0,t.showPopup=(e,t)=>new Promise((n=>{const o=document.createElement("div");o.classList.add("modal-overlay"),o.classList.add("modal-overlay-visible"),document.body.append(o);const i=document.createElement("div");i.classList.add("modal"),i.classList.add("modal-in"),i.style.display="block",i.style.marginTop="-62px",i.innerHTML=`\n    <div class="modal-inner">\n      <div class="modal-title">${e}</div>\n      <div class="modal-text">${t}</div>\n    </div>\n    <div class="modal-buttons modal-buttons-1">\n      <span class="modal-button modal-button-bold">OK</span>\n    </div>\n  `;const r=i.querySelector(".modal-button");null==r||r.addEventListener("click",(()=>{null==o||o.classList.remove("modal-overlay-visible"),i.remove(),n()})),document.body.append(i)}))},178:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BLUE_BUTTON_BORDER=t.BLUE_BUTTON=t.ORANGE_BUTTON_BORDER=t.ORANGE_BUTTON=t.GREEN_DARK_BUTTON_BORDER=t.GREEN_DARK_BUTTON=t.GREEN_BUTTON_BORDER=t.GREEN_BUTTON=t.GREEN_SUCCESS=t.YELLOW_WARNING=t.RED_ERROR=t.YELLOW_ALERT_BORDER=t.YELLOW_ALERT=t.RED_LINK=t.GREEN_LINK=void 0,t.GREEN_LINK="#90EE90",t.RED_LINK="#ED143D",t.YELLOW_ALERT="#351C04",t.YELLOW_ALERT_BORDER="#41260D",t.RED_ERROR="#FF0000",t.YELLOW_WARNING="#FFA500",t.GREEN_SUCCESS="#30D611",t.GREEN_BUTTON="#003300",t.GREEN_BUTTON_BORDER="#006600",t.GREEN_DARK_BUTTON="#001900",t.GREEN_DARK_BUTTON_BORDER="#003300",t.ORANGE_BUTTON="#351C04",t.ORANGE_BUTTON_BORDER="#41260D",t.BLUE_BUTTON="#000040",t.BLUE_BUTTON_BORDER="#00007F"}},t={};!function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(217)})();
//# sourceMappingURL=farmrpg-farmhand.user.js.map